{% extends "base.html" %}

{% block content %}
<div class="fanfic-container">
    <h1>{{ fanfic.title }}</h1>
    <p><strong>Author:</strong> {{ fanfic.author }}</p>

    <!-- Agar rasm mavjud boâ€˜lsa, uni koâ€˜rsatamiz -->
    {% if fanfic.image %}
    <img src="{{ url_for('static', filename=fanfic.image) }}" alt="Fanfic rasmi" style="max-width:100%; border-radius: 12px; margin: 20px 0;">
    {% endif %}

    <p>{{ fanfic.content }}</p>

    <!-- âœ… LIKE tugmasi AJAX bilan (JavaScript) -->
    <div style="margin-top: 20px;">
        <button id="like-btn">â¤ï¸ Like</button>
        <span id="like-count">{{ fanfic.likes }} likes</span>
    </div>

    <!-- Edit va Delete tugmalari -->
    <div style="margin-top: 30px;">
        <h3>Admin Controls âš™ï¸</h3>
        <form action="/edit/{{ fanfic.id }}" method="GET" style="display:inline;">
            <button type="submit">âœï¸ Edit</button>
        </form>
        <form action="/delete/{{ fanfic.id }}" method="POST" style="display:inline; margin-left:10px;">
            <input type="password" name="password" placeholder="Password" required>
            <button type="submit">ğŸ—‘ï¸ Delete</button>
        </form>
    </div>

    <!-- Comment form -->
    <div style="margin-top: 50px;">
        <h3>Comments ğŸ’¬</h3>
        <form action="/comment/{{ fanfic.id }}" method="POST">
            <textarea name="comment" rows="3" placeholder="Write your comment..." required></textarea><br><br>
            <button type="submit">Post Comment</button>
        </form>

        {% if fanfic.comments %}
        <ul style="margin-top: 20px;">
            {% for comment in fanfic.comments %}
            <li>{{ comment }}</li>
            {% endfor %}
        </ul>
        {% else %}
        <p style="margin-top: 10px;">No comments yet ğŸ«§</p>
        {% endif %}
    </div>
</div>

<!-- âœ… LIKE tugmasi uchun JavaScript kod -->
<script>
document.getElementById("like-btn").addEventListener("click", function () {
    fetch("/like/{{ fanfic.id }}", {
        method: "POST"
    })
    .then(response => response.text())
    .then(data => {
        if (data === "Liked") {
            let likeCount = document.getElementById("like-count");
            let current = parseInt(likeCount.textContent);
            likeCount.textContent = (current + 1) + " likes";
        } else if (data === "Already liked") {
            alert("You already liked this fanfic ğŸ’œ");
        }
    });
});
</script>
{% endblock %}


